

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>私とブログ &#8212; 鉄は熱いうちに打て</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="search" title="検索" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../../index.html">鉄は熱いうちに打て</a> &gt;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">私とブログ</a></li>
<li><a class="reference internal" href="#">どうして乗り換えたか</a></li>
<li><a class="reference internal" href="#">乗り換え方</a><ul>
<li><a class="reference internal" href="#curl">元のサイトをcurlする</a></li>
<li><a class="reference internal" href="#htmlmarkdown">htmlをMarkdownに変換</a></li>
<li><a class="reference internal" href="#sphinxhtml">Sphinxでhtmlを作ろう</a></li>
<li><a class="reference internal" href="#">インストール</a></li>
<li><a class="reference internal" href="#">プロジェクト作成</a></li>
<li><a class="reference internal" href="#">ビルド</a></li>
<li><a class="reference internal" href="#">まとめ</a></li>
<li><a class="reference internal" href="#rss">おまけ(rss)</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>date: 2016-10-22
title:  ブログをWordpressからSphinxに乗り換えた話
category: Sphinx
tags: Sphinx</p>
<div class="section" id="">
<span id="id1"></span><h1>私とブログ<a class="headerlink" href="#" title="このヘッドラインへのパーマリンク">¶</a></h1>
<ul class="simple">
<li>1995年にパソコン購入。同時にパソコン通信（niftyサーブ）開始。</li>
<li>1999年当時のプロバイダだったInfoWeb（現&#64;nifty）からホームページスペースを与えられたので、htmlを自分で書いてブログスタート。</li>
<li>2004年html書くのめんどくさくなって、どっかのブログサービスでブログ開始。</li>
<li>2006年フリーランスになったので、勉強のために自分でCMSを運営しようとhetemlと契約。Nucleus CMSにブログを乗り換え。</li>
<li>2010年Wordpressの仕事が増えて、プラグインを作ったりしていた。Nucleus CMSの更新がほぼなくなり、hetemlがサポートするPHPのバージョンと合わなくなってくる。hetemlにWordpress簡単インストールというサービスができた機にWordpressに乗り換え。</li>
<li>2016年Sphinx製の静的Webページに乗り換え</li>
</ul>
</div>
<div class="section" id="">
<span id="id2"></span><h1>どうして乗り換えたか<a class="headerlink" href="#" title="このヘッドラインへのパーマリンク">¶</a></h1>
<ul class="simple">
<li>PHPを書かなくなっているうちにhetemlのPHPがバージョン7になった。</li>
<li>Wordpressがしょっちゅう更新しろ！と言ってきて、鬱陶しくなった。</li>
<li>Wordpressにセキュリティーホールが見つかるたびにhetemlからお知らせが来て、対応しないといけないのがめんどくさくなってきた。</li>
<li>ブログしかやってないので、はてなにでも乗り換えようか。。。</li>
<li>セキュリティーとか気にしなくていい、静的HTMLに乗り換えよう！</li>
<li>せっかく、Pythonかけるようになったし、Sphinxだ！</li>
</ul>
</div>
<div class="section" id="">
<span id="id3"></span><h1>乗り換え方<a class="headerlink" href="#" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="section" id="curl">
<span id="curl"></span><h2>元のサイトをcurlする<a class="headerlink" href="#curl" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">curl</span></code>はHTTPアクセスをしてコンテンツを取得できるコマンドです。</p>
<p>私のブログは記事に番号がついていてそれがURLでした。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">kamekokamekame</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">archives</span><span class="o">/</span><span class="mi">1207</span><span class="o">/</span>
</pre></div>
</div>
<p>↑こんなの</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl http://kamekokamekame.net/archives/<span class="o">[</span><span class="m">1</span>-9999<span class="o">]</span>/ -o <span class="s2">&quot;#1.html&quot;</span>
</pre></div>
</div>
<p>これで、<code class="docutils literal notranslate"><span class="pre">[記事の番号].html</span></code>というファイル名で取得できます。</p>
</div>
<div class="section" id="htmlmarkdown">
<span id="htmlmarkdown"></span><h2>htmlをMarkdownに変換<a class="headerlink" href="#htmlmarkdown" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>htmlを編集し続けるのが嫌だったので、どこにでも持っていきやすいMarkdownにPythonスクリプト書いて置き換えました。</p>
<p>(ここが素敵だとかっこいいんですが、一回だけなんで、愚直に適当に書いてしまいました。見たかったらどうぞ <a class="reference external" href="https://gist.github.com/okusama27/66d184a5e7091b1e24948af66c205106">gist</a>)</p>
</div>
<div class="section" id="sphinxhtml">
<span id="sphinxhtml"></span><h2>Sphinxでhtmlを作ろう<a class="headerlink" href="#sphinxhtml" title="このヘッドラインへのパーマリンク">¶</a></h2>
</div>
<div class="section" id="">
<span id="id4"></span><h2>インストール<a class="headerlink" href="#" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 -m venv env
$ pip install Sphinx commonmark recommonmark
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id5"></span><h2>プロジェクト作成<a class="headerlink" href="#" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sphinx-quickstart
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">conf.py</span></code>の修正</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">source_suffix</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.rst&#39;</span><span class="p">,</span> <span class="s1">&#39;.md&#39;</span><span class="p">]</span>
<span class="n">source_parsers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;.md&#39;</span><span class="p">:</span> <span class="s1">&#39;recommonmark.parser.CommonMarkParser&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">index.rst</span></code>を作成</p>
</div>
<div class="section" id="">
<span id="id6"></span><h2>ビルド<a class="headerlink" href="#" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">html</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">build/html</span></code>フォルダの中身をサーバーにドーン！</p>
</div>
<div class="section" id="">
<span id="id7"></span><h2>まとめ<a class="headerlink" href="#" title="このヘッドラインへのパーマリンク">¶</a></h2>
<ul class="simple">
<li>実はあまりPythonをわかっていなくても, Markdownが書ければ、いいだけな気がする。</li>
<li>嫌になったら、Githubでブログを営むこともできるのでMarkdownにしておくのはいいと思う。</li>
</ul>
</div>
<div class="section" id="rss">
<span id="rss"></span><h2>おまけ(rss)<a class="headerlink" href="#rss" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>feedのプラグインがなかったんで、feedを出力してくれるスクリプトも作りました。</p>
<p>自分のMarkdownから、タイトルとか記事とか取るだけのスクリプト。（汚いですが、見たかったらどうぞ。 <a class="reference external" href="https://gist.github.com/okusama27/fc87c5f9ebd0b38590bcaa05a070736a">gist</a>）</p>
<p>結局、<code class="docutils literal notranslate"><span class="pre">feedgenerator</span></code>というのを使うと各情報を渡すだけでfeedできます。どーん。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># フィードを生成</span>
<span class="k">return</span> <span class="n">feedgenerator</span><span class="o">.</span><span class="n">Rss201rev2Feed</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">link</span><span class="o">=</span><span class="n">link</span><span class="p">,</span><span class="n">feed_url</span><span class="o">=</span><span class="n">feed_url</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span><span class="n">language</span><span class="o">=</span><span class="s2">&quot;ja&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>これはもうちょっと綺麗にしたいです。</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../../index.html">鉄は熱いうちに打て</a> &gt;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, kamekokamekame.net.
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1 で生成しました。
    </div>
  </body>
</html>